<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Island Survival</title>
    <style>
        /* v6.0 ë°”íƒ•ìƒ‰ ë° ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ìœ ì§€ */
        body { background-color: #f5f6fa; color: #2f3640; font-family: 'Malgun Gothic', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .screen { width: 1100px; height: 750px; background-color: #ffffff; border: 2px solid #dcdde1; position: relative; display: none; padding: 20px; box-sizing: border-box; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .active { display: flex; flex-direction: column; }

        /* ì‹œì‘ í™”ë©´ */
        #start-screen { justify-content: center; align-items: center; background-color: #ffffff; }
        #start-screen h1 { font-size: 80px; margin-bottom: 60px; color: #2f3640; }
        .btn-main-rect { width: 220px; height: 110px; background: #2f3640; color: white; font-size: 28px; font-weight: bold; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center; }

        /* ìºë¦­í„° ìƒì„± í™”ë©´ */
        .creation-flex { display: flex; gap: 20px; height: 550px; }
        .input-box { width: 350px; border: 1px solid #dcdde1; padding: 15px; border-radius: 8px; background: #f9f9f9; }
        .info-box { flex: 1; border: 1px solid #dcdde1; padding: 15px; border-radius: 8px; background: #ffffff; overflow-y: auto; }
        .label-sky { color: #0984e3; font-weight: bold; margin-top: 15px; display: block; font-size: 14px; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; background: white; color: #2f3640; border: 1px solid #dcdde1; box-sizing: border-box; }
        .rel-temp-list { background: #eee; padding: 8px; min-height: 40px; margin: 5px 0; font-size: 12px; color: #636e72; border: 1px dashed #b2bec3; }
        .btn-add-char { background: #0984e3; color: white; border: none; padding: 12px; width: 100%; cursor: pointer; margin-top: 20px; font-weight: bold; }

        /* ê²Œì„ í™”ë©´ */
        #game-screen { flex-direction: row; padding: 0; }
        .diary-section { width: 33.3%; border-right: 1px solid #dcdde1; padding: 20px; box-sizing: border-box; background: #fdfdfd; }
        .main-section { width: 66.7%; display: flex; flex-direction: column; }
        .inv-section { height: 30%; padding: 20px; background: #f1f2f6; border-bottom: 1px solid #dcdde1; }
        .survivor-section { height: 70%; padding: 20px; overflow-y: auto; }
        .diary-box { height: 580px; font-size: 13px; line-height: 1.6; color: #2f3640; border: 1px solid #dcdde1; padding: 10px; overflow-y: auto; background: white; }
        .diary-day-line { text-align: center; color: #d63031; margin: 15px 0 5px 0; font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* ìƒì¡´ì ì¹´ë“œ ë° ìƒíƒœë°” */
        .s-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .s-card { background: white; padding: 10px; border: 1px solid #dcdde1; border-radius: 8px; font-size: 11px; color: #2f3640; }
        .s-card.dead { filter: grayscale(100%); opacity: 0.5; }
        .stat-bar { height: 6px; background: #dfe6e9; border-radius: 3px; margin: 2px 0 5px 0; overflow: hidden; }
        .stat-fill { height: 100%; transition: width 0.3s; }
        .rel-info { font-size: 10px; color: #636e72; border-top: 1px solid #eee; padding-top: 4px; margin-top: 5px; }

        /* ì•„ì´í…œ */
        .inv-item { display: inline-block; background: white; padding: 8px 12px; margin: 4px; border-radius: 5px; border: 1px solid #0984e3; font-size: 12px; cursor: pointer; color: #0984e3; }
        .inv-item.unusable { opacity: 0.4; cursor: not-allowed; border-color: #b2bec3; color: #636e72; }
        .inv-item.selected { background: #0984e3; color: white; }

        /* ê²°ê³¼ í™”ë©´ (ì¶”ê°€ë¨) */
        #gameover-screen { justify-content: center; align-items: center; text-align: center; background-color: #2f3640; color: white; }
        #gameover-screen h2 { font-size: 50px; color: #ff7675; margin-bottom: 20px; }
        .btn-retry { padding: 20px 50px; background: #0984e3; color: white; border: none; font-size: 24px; font-weight: bold; cursor: pointer; border-radius: 10px; }

        /* ëª¨ë‹¬ */
        #event-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 100; display:none; justify-content:center; align-items:center; }
        .modal { background: white; color: #2f3640; padding: 30px; border-radius: 12px; width: 450px; text-align: center; }
        .modal button { margin: 10px; padding: 12px 20px; cursor: pointer; font-weight: bold; border: 1px solid #dcdde1; border-radius: 5px; background: white; }
    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <h1>Island Survival</h1>
        <button class="btn-main-rect" onclick="changeScreen('char-creation-screen')">START</button>
    </div>

    <div id="char-creation-screen" class="screen">
        <div style="color: #636e72; font-size: 13px; margin-bottom: 10px;">ìºë¦­í„°ë¥¼ ìƒì„±í•˜ê³  ê´€ê³„ë¥¼ ì„¤ì •í•˜ì„¸ìš”.</div>
        <div class="creation-flex">
            <div class="input-box">
                <span class="label-sky">Name (ì´ë¦„)</span>
                <input type="text" id="c-name" placeholder="ì´ë¦„ ì…ë ¥">
                <span class="label-sky">Personality (ì„±ê²©)</span>
                <select id="c-mbti"></select>
                <span class="label-sky">Job (ì§ì—…)</span>
                <select id="c-job"></select>
                <span class="label-sky">Relationship (ê´€ê³„)</span>
                <div style="display:flex; gap:5px;">
                    <select id="rel-target" style="width:45%"></select>
                    <select id="rel-type" style="width:35%">
                        <option value="ì–´ìƒ‰">ì–´ìƒ‰</option><option value="ì¹œêµ¬">ì¹œêµ¬</option>
                        <option value="ì• ì¸">ì• ì¸</option><option value="ê°€ì¡±">ê°€ì¡±</option>
                    </select>
                    <button onclick="addTempRelation()" style="width:20%; cursor:pointer;">ì¶”ê°€</button>
                </div>
                <div id="temp-rel-list" class="rel-temp-list">ì„¤ì •ëœ ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                <button class="btn-add-char" onclick="finalizeCharacter()">ìºë¦­í„° ìƒì„±</button>
            </div>
            <div class="info-box" id="char-list-area"></div>
        </div>
        <button onclick="startGame()" style="position:absolute; bottom:30px; right:30px; padding:15px 40px; background:#2ecc71; border:none; font-weight:bold; color:white; cursor:pointer; border-radius:5px;">ì‹œì‘í•˜ê¸° ></button>
    </div>

    <div id="game-screen" class="screen">
        <div class="diary-section">
            <h3>ë¬´ì¸ë„ ìƒì¡´ì¼ì§€</h3>
            <div id="diary-box" class="diary-box"></div>
        </div>
        <div class="main-section">
            <div class="inv-section">
                <h4 style="margin:0 0 10px 0;">ğŸ’ ê°€ë°©</h4>
                <div id="inv-display"></div>
            </div>
            <div class="survivor-section">
                <h4 style="margin:0 0 10px 0;">ğŸ‘¥ ìƒì¡´ì ëª©ë¡</h4>
                <div id="s-grid" class="s-grid"></div>
            </div>
        </div>
        <button onclick="nextTurn()" style="position:absolute; bottom:20px; right:20px; padding:15px 30px; background:#2f3640; border:none; color:white; font-weight:bold; cursor:pointer; border-radius:5px;">ë‹¤ìŒ í„´ ì§„í–‰</button>
    </div>

    <div id="gameover-screen" class="screen">
        <h2>ì‚´ì•„ë‚¨ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</h2>
        <p id="survival-day-count" style="font-size: 20px; margin-bottom: 30px;"></p>
        <button class="btn-retry" onclick="retryGame()">RETRY (ìºë¦­í„° ì„ íƒì°½)</button>
    </div>

    <div id="event-overlay"><div class="modal"><h2 id="ev-title"></h2><p id="ev-desc"></p><div id="ev-btns"></div></div></div>

<script>
    const MBTIS = ['infp','enfp','infj','enfj','isfp','esfp','isfj','esfj','intp','entp','intj','entj','istp','estp','istj','estj'];
    const JOBS = ['ëŒ€í•™ìƒ','êµì‚¬','ì˜ì‚¬','êµ°ì¸','ëª©ìˆ˜','ì–´ë¶€','ì‚¬ëƒ¥ê¾¼'];
    let characters = [];
    let tempRelations = [];
    let inventory = { "ë¬¼ê³ ê¸°": 0, "í†µì¡°ë¦¼": 2, "ë¬¼": 3, "í•­ìƒì œ": 1, "ê³ ê¸°": 0, "ë‚˜ë¬´": 0, "ë¶•ëŒ€": 1, "ì‘ì‚´": 0, "ë‚šì‹¯ëŒ€": 0, "ê·¸ë¬¼": 0, "ì½”ì½”ë„›": 0 };
    let day = 1;
    let selectedItem = null;

    const mbtiSel = document.getElementById('c-mbti');
    MBTIS.forEach(m => { let o = document.createElement('option'); o.value=m; o.innerText=m.toUpperCase(); mbtiSel.appendChild(o); });
    const jobSel = document.getElementById('c-job');
    JOBS.forEach(j => { let o = document.createElement('option'); o.value=j; o.innerText=j; jobSel.appendChild(o); });

    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function addTempRelation() {
        const target = document.getElementById('rel-target').value;
        const type = document.getElementById('rel-type').value;
        if(!target || tempRelations.find(r => r.target === target)) return;
        tempRelations.push({ target, type });
        renderTempRelations();
    }

    function renderTempRelations() {
        const area = document.getElementById('temp-rel-list');
        area.innerHTML = tempRelations.length === 0 ? "ì„¤ì •ëœ ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤." : tempRelations.map(r => `<div>${r.target} (${r.type})</div>`).join('');
    }

    function finalizeCharacter() {
        const name = document.getElementById('c-name').value.trim();
        const mbti = document.getElementById('c-mbti').value;
        const job = document.getElementById('c-job').value;
        if(!name || characters.find(c => c.name === name)) return alert("ì´ë¦„ ì˜¤ë¥˜");

        let newChar = { name, mbti, job, hp: 100, mp: 100, fatigue: 0, hunger: 0, thirst: 0, status: 'Alive', relations: {} };
        tempRelations.forEach(r => {
            let val = { 'ì–´ìƒ‰': 10, 'ì¹œêµ¬': 30, 'ì• ì¸': 60, 'ê°€ì¡±': 70 }[r.type];
            newChar.relations[r.target] = { type: r.type, val: val };
            let tObj = characters.find(c => c.name === r.target);
            if(tObj) tObj.relations[name] = { type: r.type, val: val };
        });

        characters.push(newChar);
        tempRelations = [];
        document.getElementById('c-name').value = '';
        renderTempRelations();
        updateCreationList();
    }

    function updateCreationList() {
        const area = document.getElementById('char-list-area');
        const targetSel = document.getElementById('rel-target');
        area.innerHTML = ''; targetSel.innerHTML = '<option value="">ëŒ€ìƒ ì„ íƒ</option>';
        characters.forEach(c => {
            let relStr = Object.entries(c.relations).map(([target, info]) => `${target}(${info.type})`).join(', ');
            area.innerHTML += `<div style="background:#f9f9f9; padding:10px; margin-bottom:5px; border:1px solid #dcdde1; border-radius:5px;"><b>${c.name}</b> [${c.mbti.toUpperCase()}/${c.job}]<br><span style="font-size:11px; color:#636e72;">ê´€ê³„: ${relStr || 'ì—†ìŒ'}</span></div>`;
            let o = document.createElement('option'); o.value = c.name; o.innerText = c.name;
            targetSel.appendChild(o);
        });
    }

    function renderInventory() {
        const div = document.getElementById('inv-display');
        div.innerHTML = '';
        const tools = ["ì‘ì‚´", "ê·¸ë¬¼", "ë‚šì‹¯ëŒ€"];
        Object.entries(inventory).forEach(([name, count]) => {
            if(count > 0) {
                let isTool = tools.includes(name);
                let item = document.createElement('span');
                item.className = `inv-item ${isTool ? 'unusable' : ''} ${selectedItem === name ? 'selected' : ''}`;
                item.innerText = `${name} x ${count}`;
                if(!isTool) item.onclick = () => { selectedItem = (selectedItem === name) ? null : name; updateAll(); };
                div.appendChild(item);
            }
        });
    }

    function renderSurvivors() {
        const grid = document.getElementById('s-grid');
        grid.innerHTML = '';
        characters.forEach(c => {
            const card = document.createElement('div');
            card.className = `s-card ${c.status !== 'Alive' ? 'dead' : ''}`;
            let rels = Object.entries(c.relations).map(([target, info]) => `${target}(${info.type}:${info.val})`).join(', ');
            card.innerHTML = `
                <div style="font-weight:bold; color:#0984e3">${c.name} [${c.status}]</div>
                <div style="margin-bottom:5px;">${c.mbti.toUpperCase()} / ${c.job}</div>
                ì²´ë ¥ <div class="stat-bar"><div class="stat-fill" style="width:${c.hp}%; background:#ff7675"></div></div>
                ì •ì‹  <div class="stat-bar"><div class="stat-fill" style="width:${c.mp}%; background:#a29bfe"></div></div>
                í”¼ë¡œ <div class="stat-bar"><div class="stat-fill" style="width:${c.fatigue}%; background:#fd79a8"></div></div>
                í—ˆê¸° <div class="stat-bar"><div class="stat-fill" style="width:${c.hunger}%; background:#fdcb6e"></div></div>
                ê°ˆì¦ <div class="stat-bar"><div class="stat-fill" style="width:${c.thirst}%; background:#74b9ff"></div></div>
                <div class="rel-info">ê´€ê³„: ${rels || 'ì—†ìŒ'}</div>
                ${selectedItem && c.status === 'Alive' ? `<button onclick="useItemOn('${c.name}')" style="width:100%; margin-top:5px; cursor:pointer; background:#0984e3; color:white; border:none; padding:4px; border-radius:3px;">ì‚¬ìš©</button>` : ''}
            `;
            grid.appendChild(card);
        });
    }

    function useItemOn(name) {
        let c = characters.find(x => x.name === name);
        if(selectedItem === 'ë¬¼') c.thirst = Math.max(0, c.thirst - 30);
        else if(['ë¬¼ê³ ê¸°', 'ê³ ê¸°', 'í†µì¡°ë¦¼'].includes(selectedItem)) c.hunger = Math.max(0, c.hunger - 30);
        else if(['í•­ìƒì œ', 'ë¶•ëŒ€'].includes(selectedItem)) c.hp = Math.min(100, c.hp + 20);
        inventory[selectedItem]--; selectedItem = null; updateAll();
    }

    function checkGameOver() {
        if (characters.length > 0 && characters.every(c => c.status !== 'Alive')) {
            document.getElementById('survival-day-count').innerText = `ì´ ${day-1}ì¼ ë™ì•ˆ ìƒì¡´í•˜ì˜€ìŠµë‹ˆë‹¤.`;
            changeScreen('gameover-screen');
        }
    }

    function retryGame() {
        characters = []; day = 1;
        inventory = { "ë¬¼ê³ ê¸°": 0, "í†µì¡°ë¦¼": 2, "ë¬¼": 3, "í•­ìƒì œ": 1, "ê³ ê¸°": 0, "ë‚˜ë¬´": 0, "ë¶•ëŒ€": 1, "ì‘ì‚´": 0, "ë‚šì‹¯ëŒ€": 0, "ê·¸ë¬¼": 0, "ì½”ì½”ë„›": 0 };
        document.getElementById('diary-box').innerHTML = '';
        updateCreationList();
        changeScreen('char-creation-screen');
    }

    function nextTurn() {
        logDiary(`------ Day ${day} ------`, true);
        characters.forEach(c => {
            if(c.status !== 'Alive') return;
            c.hunger = Math.min(100, c.hunger + 10); c.thirst = Math.min(100, c.thirst + 10); c.fatigue = Math.min(100, c.fatigue + 5);
            if(c.hunger >= 100 || c.thirst >= 100) c.hp = Math.max(0, c.hp - 10);
            if(c.hp <= 0) c.status = 'Dead';
            Object.values(c.relations).forEach(r => r.val = Math.min(100, r.val + 1));
        });
        if(Math.random() > 0.5) handleWeather(); else handleChoice();
        characters.forEach(c => { if(c.status === 'Alive' && c.fatigue < 100) { if(Math.random() > 0.5) handleMBTI(c); else handleJob(c); }});
        day++; updateAll();
    }

    function handleWeather() {
        const r = Math.random();
        if(r < 0.2) { logDiary("ë‚ ì”¨ê°€ ë§‘ìŠµë‹ˆë‹¤."); characters.forEach(c => c.mp = Math.min(100, c.mp+5)); }
        else if(r < 0.7) { logDiary("ë¹„ê°€ ë‚´ë¦½ë‹ˆë‹¤. ë¬¼+2"); inventory["ë¬¼"] += 2; }
        else { logDiary("í­í’ìš°ê°€ ì¹©ë‹ˆë‹¤. ì •ì‹ ë ¥-10"); characters.forEach(c => c.mp = Math.max(0, c.mp-10)); }
    }

    function handleChoice() {
        showModal("ë‚šì‹œ ê¸°íšŒ", "ë¬¼ê³ ê¸° ë–¼ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!", [
            { text: "ì†ìœ¼ë¡œ ì¡ëŠ”ë‹¤", cb: () => { inventory["ë¬¼ê³ ê¸°"]+=1; logDiary("ì†ìœ¼ë¡œ ë¬¼ê³ ê¸°ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤."); updateAll(); }},
            { text: "ì‘ì‚´ ì‚¬ìš©", disabled: inventory["ì‘ì‚´"]===0, cb: () => { inventory["ì‘ì‚´"]--; inventory["ë¬¼ê³ ê¸°"]+=3; logDiary("ì‘ì‚´ë¡œ ë¬¼ê³ ê¸°ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤! (ì‘ì‚´-1)"); updateAll(); }},
            { text: "ê·¸ë¬¼ ì‚¬ìš©", disabled: inventory["ê·¸ë¬¼"]===0, cb: () => { inventory["ê·¸ë¬¼"]--; inventory["ë¬¼ê³ ê¸°"]+=5; logDiary("ê·¸ë¬¼ë¡œ ë¬¼ê³ ê¸°ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤! (ê·¸ë¬¼-1)"); updateAll(); }}
        ]);
    }

    function handleJob(c) {
        if(c.job === 'ì˜ì‚¬') { logDiary(`(ì˜ì‚¬) ${c.name}: í•­ìƒì œë¥¼ ì œì¡°í–ˆìŠµë‹ˆë‹¤.`); inventory["í•­ìƒì œ"]++; }
        else if(c.job === 'ëª©ìˆ˜') { logDiary(`(ëª©ìˆ˜) ${c.name}: ì‘ì‚´ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`); inventory["ì‘ì‚´"]++; }
        else if(c.job === 'ì‚¬ëƒ¥ê¾¼') { logDiary(`(ì‚¬ëƒ¥ê¾¼) ${c.name}: ê·¸ë¬¼ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`); inventory["ê·¸ë¬¼"]++; }
        else logDiary(`(${c.job}) ${c.name}: ìƒì¡´ í™œë™ì„ í•©ë‹ˆë‹¤.`);
    }

    function handleMBTI(c) {
        logDiary(`(${c.mbti.toUpperCase()}) ${c.name}: í¬ë§ì„ ì°¾ìŠµë‹ˆë‹¤.`);
        c.mp = Math.min(100, c.mp+5);
    }

    function logDiary(msg, isDayLine = false) {
        const box = document.getElementById('diary-box');
        box.innerHTML += isDayLine ? `<div class="diary-day-line">${msg}</div>` : `<div>${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function showModal(title, desc, btns) {
        const overlay = document.getElementById('event-overlay');
        document.getElementById('ev-title').innerText = title;
        document.getElementById('ev-desc').innerText = desc;
        const btnArea = document.getElementById('ev-btns'); btnArea.innerHTML = '';
        btns.forEach(b => {
            let btn = document.createElement('button'); btn.innerText = b.text;
            if(b.disabled) btn.disabled = true;
            btn.onclick = () => { overlay.style.display = 'none'; b.cb(); };
            btnArea.appendChild(btn);
        });
        overlay.style.display = 'flex';
    }

    function startGame() { if(characters.length > 0) { changeScreen('game-screen'); updateAll(); } else alert("ìºë¦­í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”."); }
    function updateAll() { renderInventory(); renderSurvivors(); checkGameOver(); }
</script>
</body>
</html>